/*
 * http://pegjs.majda.cz/
 *
 * Generated by PEG.js 0.7.0.
 * from followin grammar:

Query =
  Expression / ''

Expression =
  left:AndExpr right:(' '+ 'or' ' '+ AndExpr )*
  {
    if(right.length) {
      var result = {or: [left]}
      for( var i=0; i < right.length; i++) {
        result.or.push(right[i][3]);
      }
      return result;
    } else {
      return left;
    }
  }

AndExpr =
  left:Term right:(' '+ 'and' ' '+ Term )*
  {
    if(right.length) {
      var result = {and: [left]}
      for( var i=0; i < right.length; i++) {
        result.and.push(right[i][3]);
      }
      return result;
    } else {
      return left;
    }
  }

Term =
  Token
/
  '(' ' '* expr:Expression ' '* ')' 
  {return expr;}

Token =
  id:Identifier ' '* op:Operator ' '* val:Value 
  {
    var obj = {};
    if (op === ':') {
      val = new RegExp(val, 'im')
    }
    obj[id] = val;
    return obj;
  }

Identifier = 
  first:[a-zA-Z_] next:[a-zA-Z0-9_.]* 
  {return first+next.join('');}

Operator = 
  ':' / '='

Value =
  Boolean / String / Float / Integer / '!'

Boolean =
  'true' / 'false'

Integer =
  sign:'-'? digit:[0-9]+ 
  {return parseInt(sign+digit.join(''));}

Float =
  digit:Integer '.' decimal:[0-9]+ 
  {return parseFloat(digit+'.'+decimal.join(''));}

String = 
  '"' content:('\\"' / [^"])* '"' 
  {return content.join('');} 
/
  "'" content:("\\'" / [^'])* "'" 
  {return content.join('');}

 */
QueryParser=(function(){function b(c){return'"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var a={parse:function(n,s){var c={Query:p,Expression:A,AndExpr:h,Term:g,Token:t,Identifier:k,Operator:D,Value:E,Boolean:m,Integer:B,Float:d,String:v};if(s!==undefined){if(c[s]===undefined){throw new Error("Invalid rule name: "+b(s)+".")}}else{s="Query"}var f={offset:0,line:1,column:1,seenCR:false};var x=0;var i={offset:0,line:1,column:1,seenCR:false};var y=[];function z(G,K,I){var F=G;var J=I-G.length;for(var H=0;H<J;H++){F=K+F}return F}function w(H){var G=H.charCodeAt(0);var F;var I;if(G<=255){F="x";I=2}else{F="u";I=4}return"\\"+F+z(G.toString(16).toUpperCase(),"0",I)}function C(G){var F={};for(var H in G){F[H]=G[H]}return F}function u(J,I){var F=J.offset+I;for(var H=J.offset;H<F;H++){var G=n.charAt(H);if(G==="\n"){if(!J.seenCR){J.line++}J.column=1;J.seenCR=false}else{if(G==="\r"||G==="\u2028"||G==="\u2029"){J.line++;J.column=1;J.seenCR=true}else{J.column++;J.seenCR=false}}}J.offset+=I}function q(F){if(f.offset<i.offset){return}if(f.offset>i.offset){i=C(f);y=[]}y.push(F)}function p(){var F;F=A();if(F===null){F=""}return F}function A(){var K,J,I,H,G,F;var N,M,L;N=C(f);M=C(f);K=h();if(K!==null){J=[];L=C(f);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}}}else{I=null}if(I!==null){if(n.substr(f.offset,2)==="or"){H="or";u(f,2)}else{H=null;if(x===0){q('"or"')}}if(H!==null){if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}}}else{G=null}if(G!==null){F=h();if(F!==null){I=[I,H,G,F]}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}while(I!==null){J.push(I);L=C(f);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}}}else{I=null}if(I!==null){if(n.substr(f.offset,2)==="or"){H="or";u(f,2)}else{H=null;if(x===0){q('"or"')}}if(H!==null){if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}}}else{G=null}if(G!==null){F=h();if(F!==null){I=[I,H,G,F]}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}}if(J!==null){K=[K,J]}else{K=null;f=C(M)}}else{K=null;f=C(M)}if(K!==null){K=(function(U,P,S,T,R){if(R.length){var O={or:[T]};for(var Q=0;Q<R.length;Q++){O.or.push(R[Q][3])}return O}else{return T}})(N.offset,N.line,N.column,K[0],K[1])}if(K===null){f=C(N)}return K}function h(){var K,J,I,H,G,F;var N,M,L;N=C(f);M=C(f);K=g();if(K!==null){J=[];L=C(f);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}}}else{I=null}if(I!==null){if(n.substr(f.offset,3)==="and"){H="and";u(f,3)}else{H=null;if(x===0){q('"and"')}}if(H!==null){if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}}}else{G=null}if(G!==null){F=g();if(F!==null){I=[I,H,G,F]}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}while(I!==null){J.push(I);L=C(f);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}}}else{I=null}if(I!==null){if(n.substr(f.offset,3)==="and"){H="and";u(f,3)}else{H=null;if(x===0){q('"and"')}}if(H!==null){if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}}}else{G=null}if(G!==null){F=g();if(F!==null){I=[I,H,G,F]}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}}else{I=null;f=C(L)}}if(J!==null){K=[K,J]}else{K=null;f=C(M)}}else{K=null;f=C(M)}if(K!==null){K=(function(U,P,S,T,R){if(R.length){var O={and:[T]};for(var Q=0;Q<R.length;Q++){O.and.push(R[Q][3])}return O}else{return T}})(N.offset,N.line,N.column,K[0],K[1])}if(K===null){f=C(N)}return K}function g(){var K,I,H,G,F;var L,J;K=t();if(K===null){L=C(f);J=C(f);if(n.charCodeAt(f.offset)===40){K="(";u(f,1)}else{K=null;if(x===0){q('"("')}}if(K!==null){I=[];if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}while(H!==null){I.push(H);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}}if(I!==null){H=A();if(H!==null){G=[];if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}while(F!==null){G.push(F);if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}}if(G!==null){if(n.charCodeAt(f.offset)===41){F=")";u(f,1)}else{F=null;if(x===0){q('")"')}}if(F!==null){K=[K,I,H,G,F]}else{K=null;f=C(J)}}else{K=null;f=C(J)}}else{K=null;f=C(J)}}else{K=null;f=C(J)}}else{K=null;f=C(J)}if(K!==null){K=(function(P,M,N,O){return O})(L.offset,L.line,L.column,K[2])}if(K===null){f=C(L)}}return K}function t(){var K,I,H,G,F;var L,J;L=C(f);J=C(f);K=k();if(K!==null){I=[];if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}while(H!==null){I.push(H);if(n.charCodeAt(f.offset)===32){H=" ";u(f,1)}else{H=null;if(x===0){q('" "')}}}if(I!==null){H=D();if(H!==null){G=[];if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}while(F!==null){G.push(F);if(n.charCodeAt(f.offset)===32){F=" ";u(f,1)}else{F=null;if(x===0){q('" "')}}}if(G!==null){F=E();if(F!==null){K=[K,I,H,G,F]}else{K=null;f=C(J)}}else{K=null;f=C(J)}}else{K=null;f=C(J)}}else{K=null;f=C(J)}}else{K=null;f=C(J)}if(K!==null){K=(function(Q,M,N,S,R,P){var O={};if(R===":"){P=new RegExp(P,"im")}O[S]=P;return O})(L.offset,L.line,L.column,K[0],K[2],K[4])}if(K===null){f=C(L)}return K}function k(){var I,G,F;var J,H;J=C(f);H=C(f);if(/^[a-zA-Z_]/.test(n.charAt(f.offset))){I=n.charAt(f.offset);u(f,1)}else{I=null;if(x===0){q("[a-zA-Z_]")}}if(I!==null){G=[];if(/^[a-zA-Z0-9_.]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[a-zA-Z0-9_.]")}}while(F!==null){G.push(F);if(/^[a-zA-Z0-9_.]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[a-zA-Z0-9_.]")}}}if(G!==null){I=[I,G]}else{I=null;f=C(H)}}else{I=null;f=C(H)}if(I!==null){I=(function(O,K,M,N,L){return N+L.join("")})(J.offset,J.line,J.column,I[0],I[1])}if(I===null){f=C(J)}return I}function D(){var F;if(n.charCodeAt(f.offset)===58){F=":";u(f,1)}else{F=null;if(x===0){q('":"')}}if(F===null){if(n.charCodeAt(f.offset)===61){F="=";u(f,1)}else{F=null;if(x===0){q('"="')}}}return F}function E(){var F;F=m();if(F===null){F=v();if(F===null){F=d();if(F===null){F=B();if(F===null){if(n.charCodeAt(f.offset)===33){F="!";u(f,1)}else{F=null;if(x===0){q('"!"')}}}}}}return F}function m(){var F;if(n.substr(f.offset,4)==="true"){F="true";u(f,4)}else{F=null;if(x===0){q('"true"')}}if(F===null){if(n.substr(f.offset,5)==="false"){F="false";u(f,5)}else{F=null;if(x===0){q('"false"')}}}return F}function B(){var I,G,F;var J,H;J=C(f);H=C(f);if(n.charCodeAt(f.offset)===45){I="-";u(f,1)}else{I=null;if(x===0){q('"-"')}}I=I!==null?I:"";if(I!==null){if(/^[0-9]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[0-9]")}}if(F!==null){G=[];while(F!==null){G.push(F);if(/^[0-9]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[0-9]")}}}}else{G=null}if(G!==null){I=[I,G]}else{I=null;f=C(H)}}else{I=null;f=C(H)}if(I!==null){I=(function(N,L,M,K,O){return parseInt(K+O.join(""))})(J.offset,J.line,J.column,I[0],I[1])}if(I===null){f=C(J)}return I}function d(){var J,H,G,F;var K,I;K=C(f);I=C(f);J=B();if(J!==null){if(n.charCodeAt(f.offset)===46){H=".";u(f,1)}else{H=null;if(x===0){q('"."')}}if(H!==null){if(/^[0-9]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[0-9]")}}if(F!==null){G=[];while(F!==null){G.push(F);if(/^[0-9]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[0-9]")}}}}else{G=null}if(G!==null){J=[J,H,G]}else{J=null;f=C(I)}}else{J=null;f=C(I)}}else{J=null;f=C(I)}if(J!==null){J=(function(O,M,N,P,L){return parseFloat(P+"."+L.join(""))})(K.offset,K.line,K.column,J[0],J[2])}if(J===null){f=C(K)}return J}function v(){var I,G,F;var J,H;J=C(f);H=C(f);if(n.charCodeAt(f.offset)===34){I='"';u(f,1)}else{I=null;if(x===0){q('"\\""')}}if(I!==null){G=[];if(n.substr(f.offset,2)==='\\"'){F='\\"';u(f,2)}else{F=null;if(x===0){q('"\\\\\\""')}}if(F===null){if(/^[^"]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q('[^"]')}}}while(F!==null){G.push(F);if(n.substr(f.offset,2)==='\\"'){F='\\"';u(f,2)}else{F=null;if(x===0){q('"\\\\\\""')}}if(F===null){if(/^[^"]/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q('[^"]')}}}}if(G!==null){if(n.charCodeAt(f.offset)===34){F='"';u(f,1)}else{F=null;if(x===0){q('"\\""')}}if(F!==null){I=[I,G,F]}else{I=null;f=C(H)}}else{I=null;f=C(H)}}else{I=null;f=C(H)}if(I!==null){I=(function(N,K,L,M){return M.join("")})(J.offset,J.line,J.column,I[1])}if(I===null){f=C(J)}if(I===null){J=C(f);H=C(f);if(n.charCodeAt(f.offset)===39){I="'";u(f,1)}else{I=null;if(x===0){q('"\'"')}}if(I!==null){G=[];if(n.substr(f.offset,2)==="\\'"){F="\\'";u(f,2)}else{F=null;if(x===0){q('"\\\\\'"')}}if(F===null){if(/^[^']/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[^']")}}}while(F!==null){G.push(F);if(n.substr(f.offset,2)==="\\'"){F="\\'";u(f,2)}else{F=null;if(x===0){q('"\\\\\'"')}}if(F===null){if(/^[^']/.test(n.charAt(f.offset))){F=n.charAt(f.offset);u(f,1)}else{F=null;if(x===0){q("[^']")}}}}if(G!==null){if(n.charCodeAt(f.offset)===39){F="'";u(f,1)}else{F=null;if(x===0){q('"\'"')}}if(F!==null){I=[I,G,F]}else{I=null;f=C(H)}}else{I=null;f=C(H)}}else{I=null;f=C(H)}if(I!==null){I=(function(N,K,L,M){return M.join("")})(J.offset,J.line,J.column,I[1])}if(I===null){f=C(J)}}return I}function j(H){H.sort();var I=null;var G=[];for(var F=0;F<H.length;F++){if(H[F]!==I){G.push(H[F]);I=H[F]}}return G}var l=c[s]();if(l===null||f.offset!==n.length){var e=Math.max(f.offset,i.offset);var o=e<n.length?n.charAt(e):null;var r=f.offset>i.offset?f:i;throw new this.SyntaxError(j(y),o,e,r.line,r.column)}return l},toSource:function(){return this._source}};a.SyntaxError=function(f,g,h,d,e){function c(k,l){var i,j;switch(k.length){case 0:i="end of input";break;case 1:i=k[0];break;default:i=k.slice(0,k.length-1).join(", ")+" or "+k[k.length-1]}j=l?b(l):"end of input";return"Expected "+i+" but "+j+" found."}this.name="SyntaxError";this.expected=f;this.found=g;this.message=c(f,g);this.offset=h;this.line=d;this.column=e};a.SyntaxError.prototype=Error.prototype;return a})();