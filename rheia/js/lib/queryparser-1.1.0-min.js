/*
 * http://pegjs.majda.cz/
 *
 * Generated by PEG.js 0.7.0.
 * from followin grammar:

Query =
  Expression / ''

Expression =
  left:AndExpr right:(' '+ 'or' ' '+ AndExpr )*
  {
    if(right.length) {
      var result = {or: [left]}
      for( var i=0; i < right.length; i++) {
        result.or.push(right[i][3]);
      }
      return result;
    } else {
      return left;
    }
  }

AndExpr =
  left:Term right:(' '+ 'and' ' '+ Term )*
  {
    if(right.length) {
      var result = {and: [left]}
      for( var i=0; i < right.length; i++) {
        result.and.push(right[i][3]);
      }
      return result;
    } else {
      return left;
    }
  }

Term =
  Token
/
  '(' ' '* expr:Expression ' '* ')' 
  {return expr;}

Token =
  id:Identifier ' '* ':' ' '* val:Value 
  {
    var obj = {};
    obj[id] = val;
    return obj;
  }

Identifier = 
  first:[a-zA-Z_] next:[a-zA-Z0-9_.]* 
  {return first+next.join('');}

Value =
  Boolean / String / Float / Integer / Regex / '!'

Regex = 
  '/' content:('\\/' / [^/])+ '/' flag:('i'/'m')? 
  {return new RegExp(content.join(''), flag);}

Boolean =
  'true' / 'false'

Integer =
  sign:'-'? digit:[0-9]+ 
  {return parseInt(sign+digit.join(''));}

Float =
  digit:Integer '.' decimal:[0-9]+ 
  {return parseFloat(digit+'.'+decimal.join(''));}

String = 
  '"' content:('\\"' / [^"])* '"' 
  {return content.join('');} 
/
  "'" content:("\\'" / [^'])* "'" 
  {return content.join('');}

 */
QueryParser=(function(){function b(c){return'"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var a={parse:function(o,t){var c={Query:q,Expression:B,AndExpr:h,Term:g,Token:u,Identifier:k,Value:E,Regex:l,Boolean:n,Integer:C,Float:d,String:w};if(t!==undefined){if(c[t]===undefined){throw new Error("Invalid rule name: "+b(t)+".")}}else{t="Query"}var f={offset:0,line:1,column:1,seenCR:false};var y=0;var i={offset:0,line:1,column:1,seenCR:false};var z=[];function A(G,K,I){var F=G;var J=I-G.length;for(var H=0;H<J;H++){F=K+F}return F}function x(H){var G=H.charCodeAt(0);var F;var I;if(G<=255){F="x";I=2}else{F="u";I=4}return"\\"+F+A(G.toString(16).toUpperCase(),"0",I)}function D(G){var F={};for(var H in G){F[H]=G[H]}return F}function v(J,I){var F=J.offset+I;for(var H=J.offset;H<F;H++){var G=o.charAt(H);if(G==="\n"){if(!J.seenCR){J.line++}J.column=1;J.seenCR=false}else{if(G==="\r"||G==="\u2028"||G==="\u2029"){J.line++;J.column=1;J.seenCR=true}else{J.column++;J.seenCR=false}}}J.offset+=I}function r(F){if(f.offset<i.offset){return}if(f.offset>i.offset){i=D(f);z=[]}z.push(F)}function q(){var F;F=B();if(F===null){F=""}return F}function B(){var K,J,I,H,G,F;var N,M,L;N=D(f);M=D(f);K=h();if(K!==null){J=[];L=D(f);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}}}else{I=null}if(I!==null){if(o.substr(f.offset,2)==="or"){H="or";v(f,2)}else{H=null;if(y===0){r('"or"')}}if(H!==null){if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}}}else{G=null}if(G!==null){F=h();if(F!==null){I=[I,H,G,F]}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}while(I!==null){J.push(I);L=D(f);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}}}else{I=null}if(I!==null){if(o.substr(f.offset,2)==="or"){H="or";v(f,2)}else{H=null;if(y===0){r('"or"')}}if(H!==null){if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}}}else{G=null}if(G!==null){F=h();if(F!==null){I=[I,H,G,F]}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}}if(J!==null){K=[K,J]}else{K=null;f=D(M)}}else{K=null;f=D(M)}if(K!==null){K=(function(U,P,S,T,R){if(R.length){var O={or:[T]};for(var Q=0;Q<R.length;Q++){O.or.push(R[Q][3])}return O}else{return T}})(N.offset,N.line,N.column,K[0],K[1])}if(K===null){f=D(N)}return K}function h(){var K,J,I,H,G,F;var N,M,L;N=D(f);M=D(f);K=g();if(K!==null){J=[];L=D(f);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}}}else{I=null}if(I!==null){if(o.substr(f.offset,3)==="and"){H="and";v(f,3)}else{H=null;if(y===0){r('"and"')}}if(H!==null){if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}}}else{G=null}if(G!==null){F=g();if(F!==null){I=[I,H,G,F]}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}while(I!==null){J.push(I);L=D(f);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}if(H!==null){I=[];while(H!==null){I.push(H);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}}}else{I=null}if(I!==null){if(o.substr(f.offset,3)==="and"){H="and";v(f,3)}else{H=null;if(y===0){r('"and"')}}if(H!==null){if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}if(F!==null){G=[];while(F!==null){G.push(F);if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}}}else{G=null}if(G!==null){F=g();if(F!==null){I=[I,H,G,F]}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}}else{I=null;f=D(L)}}if(J!==null){K=[K,J]}else{K=null;f=D(M)}}else{K=null;f=D(M)}if(K!==null){K=(function(U,P,S,T,R){if(R.length){var O={and:[T]};for(var Q=0;Q<R.length;Q++){O.and.push(R[Q][3])}return O}else{return T}})(N.offset,N.line,N.column,K[0],K[1])}if(K===null){f=D(N)}return K}function g(){var K,I,H,G,F;var L,J;K=u();if(K===null){L=D(f);J=D(f);if(o.charCodeAt(f.offset)===40){K="(";v(f,1)}else{K=null;if(y===0){r('"("')}}if(K!==null){I=[];if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}while(H!==null){I.push(H);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}}if(I!==null){H=B();if(H!==null){G=[];if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}while(F!==null){G.push(F);if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}}if(G!==null){if(o.charCodeAt(f.offset)===41){F=")";v(f,1)}else{F=null;if(y===0){r('")"')}}if(F!==null){K=[K,I,H,G,F]}else{K=null;f=D(J)}}else{K=null;f=D(J)}}else{K=null;f=D(J)}}else{K=null;f=D(J)}}else{K=null;f=D(J)}if(K!==null){K=(function(P,M,N,O){return O})(L.offset,L.line,L.column,K[2])}if(K===null){f=D(L)}}return K}function u(){var K,I,H,G,F;var L,J;L=D(f);J=D(f);K=k();if(K!==null){I=[];if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}while(H!==null){I.push(H);if(o.charCodeAt(f.offset)===32){H=" ";v(f,1)}else{H=null;if(y===0){r('" "')}}}if(I!==null){if(o.charCodeAt(f.offset)===58){H=":";v(f,1)}else{H=null;if(y===0){r('":"')}}if(H!==null){G=[];if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}while(F!==null){G.push(F);if(o.charCodeAt(f.offset)===32){F=" ";v(f,1)}else{F=null;if(y===0){r('" "')}}}if(G!==null){F=E();if(F!==null){K=[K,I,H,G,F]}else{K=null;f=D(J)}}else{K=null;f=D(J)}}else{K=null;f=D(J)}}else{K=null;f=D(J)}}else{K=null;f=D(J)}if(K!==null){K=(function(Q,M,N,R,P){var O={};O[R]=P;return O})(L.offset,L.line,L.column,K[0],K[4])}if(K===null){f=D(L)}return K}function k(){var I,G,F;var J,H;J=D(f);H=D(f);if(/^[a-zA-Z_]/.test(o.charAt(f.offset))){I=o.charAt(f.offset);v(f,1)}else{I=null;if(y===0){r("[a-zA-Z_]")}}if(I!==null){G=[];if(/^[a-zA-Z0-9_.]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[a-zA-Z0-9_.]")}}while(F!==null){G.push(F);if(/^[a-zA-Z0-9_.]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[a-zA-Z0-9_.]")}}}if(G!==null){I=[I,G]}else{I=null;f=D(H)}}else{I=null;f=D(H)}if(I!==null){I=(function(O,K,M,N,L){return N+L.join("")})(J.offset,J.line,J.column,I[0],I[1])}if(I===null){f=D(J)}return I}function E(){var F;F=n();if(F===null){F=w();if(F===null){F=d();if(F===null){F=C();if(F===null){F=l();if(F===null){if(o.charCodeAt(f.offset)===33){F="!";v(f,1)}else{F=null;if(y===0){r('"!"')}}}}}}}return F}function l(){var J,H,G,F;var K,I;K=D(f);I=D(f);if(o.charCodeAt(f.offset)===47){J="/";v(f,1)}else{J=null;if(y===0){r('"/"')}}if(J!==null){if(o.substr(f.offset,2)==="\\/"){G="\\/";v(f,2)}else{G=null;if(y===0){r('"\\\\/"')}}if(G===null){if(/^[^\/]/.test(o.charAt(f.offset))){G=o.charAt(f.offset);v(f,1)}else{G=null;if(y===0){r("[^\\/]")}}}if(G!==null){H=[];while(G!==null){H.push(G);if(o.substr(f.offset,2)==="\\/"){G="\\/";v(f,2)}else{G=null;if(y===0){r('"\\\\/"')}}if(G===null){if(/^[^\/]/.test(o.charAt(f.offset))){G=o.charAt(f.offset);v(f,1)}else{G=null;if(y===0){r("[^\\/]")}}}}}else{H=null}if(H!==null){if(o.charCodeAt(f.offset)===47){G="/";v(f,1)}else{G=null;if(y===0){r('"/"')}}if(G!==null){if(o.charCodeAt(f.offset)===105){F="i";v(f,1)}else{F=null;if(y===0){r('"i"')}}if(F===null){if(o.charCodeAt(f.offset)===109){F="m";v(f,1)}else{F=null;if(y===0){r('"m"')}}}F=F!==null?F:"";if(F!==null){J=[J,H,G,F]}else{J=null;f=D(I)}}else{J=null;f=D(I)}}else{J=null;f=D(I)}}else{J=null;f=D(I)}if(J!==null){J=(function(P,M,N,O,L){return new RegExp(O.join(""),L)})(K.offset,K.line,K.column,J[1],J[3])}if(J===null){f=D(K)}return J}function n(){var F;if(o.substr(f.offset,4)==="true"){F="true";v(f,4)}else{F=null;if(y===0){r('"true"')}}if(F===null){if(o.substr(f.offset,5)==="false"){F="false";v(f,5)}else{F=null;if(y===0){r('"false"')}}}return F}function C(){var I,G,F;var J,H;J=D(f);H=D(f);if(o.charCodeAt(f.offset)===45){I="-";v(f,1)}else{I=null;if(y===0){r('"-"')}}I=I!==null?I:"";if(I!==null){if(/^[0-9]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[0-9]")}}if(F!==null){G=[];while(F!==null){G.push(F);if(/^[0-9]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[0-9]")}}}}else{G=null}if(G!==null){I=[I,G]}else{I=null;f=D(H)}}else{I=null;f=D(H)}if(I!==null){I=(function(N,L,M,K,O){return parseInt(K+O.join(""))})(J.offset,J.line,J.column,I[0],I[1])}if(I===null){f=D(J)}return I}function d(){var J,H,G,F;var K,I;K=D(f);I=D(f);J=C();if(J!==null){if(o.charCodeAt(f.offset)===46){H=".";v(f,1)}else{H=null;if(y===0){r('"."')}}if(H!==null){if(/^[0-9]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[0-9]")}}if(F!==null){G=[];while(F!==null){G.push(F);if(/^[0-9]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[0-9]")}}}}else{G=null}if(G!==null){J=[J,H,G]}else{J=null;f=D(I)}}else{J=null;f=D(I)}}else{J=null;f=D(I)}if(J!==null){J=(function(O,M,N,P,L){return parseFloat(P+"."+L.join(""))})(K.offset,K.line,K.column,J[0],J[2])}if(J===null){f=D(K)}return J}function w(){var I,G,F;var J,H;J=D(f);H=D(f);if(o.charCodeAt(f.offset)===34){I='"';v(f,1)}else{I=null;if(y===0){r('"\\""')}}if(I!==null){G=[];if(o.substr(f.offset,2)==='\\"'){F='\\"';v(f,2)}else{F=null;if(y===0){r('"\\\\\\""')}}if(F===null){if(/^[^"]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r('[^"]')}}}while(F!==null){G.push(F);if(o.substr(f.offset,2)==='\\"'){F='\\"';v(f,2)}else{F=null;if(y===0){r('"\\\\\\""')}}if(F===null){if(/^[^"]/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r('[^"]')}}}}if(G!==null){if(o.charCodeAt(f.offset)===34){F='"';v(f,1)}else{F=null;if(y===0){r('"\\""')}}if(F!==null){I=[I,G,F]}else{I=null;f=D(H)}}else{I=null;f=D(H)}}else{I=null;f=D(H)}if(I!==null){I=(function(N,K,L,M){return M.join("")})(J.offset,J.line,J.column,I[1])}if(I===null){f=D(J)}if(I===null){J=D(f);H=D(f);if(o.charCodeAt(f.offset)===39){I="'";v(f,1)}else{I=null;if(y===0){r('"\'"')}}if(I!==null){G=[];if(o.substr(f.offset,2)==="\\'"){F="\\'";v(f,2)}else{F=null;if(y===0){r('"\\\\\'"')}}if(F===null){if(/^[^']/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[^']")}}}while(F!==null){G.push(F);if(o.substr(f.offset,2)==="\\'"){F="\\'";v(f,2)}else{F=null;if(y===0){r('"\\\\\'"')}}if(F===null){if(/^[^']/.test(o.charAt(f.offset))){F=o.charAt(f.offset);v(f,1)}else{F=null;if(y===0){r("[^']")}}}}if(G!==null){if(o.charCodeAt(f.offset)===39){F="'";v(f,1)}else{F=null;if(y===0){r('"\'"')}}if(F!==null){I=[I,G,F]}else{I=null;f=D(H)}}else{I=null;f=D(H)}}else{I=null;f=D(H)}if(I!==null){I=(function(N,K,L,M){return M.join("")})(J.offset,J.line,J.column,I[1])}if(I===null){f=D(J)}}return I}function j(H){H.sort();var I=null;var G=[];for(var F=0;F<H.length;F++){if(H[F]!==I){G.push(H[F]);I=H[F]}}return G}var m=c[t]();if(m===null||f.offset!==o.length){var e=Math.max(f.offset,i.offset);var p=e<o.length?o.charAt(e):null;var s=f.offset>i.offset?f:i;throw new this.SyntaxError(j(z),p,e,s.line,s.column)}return m},toSource:function(){return this._source}};a.SyntaxError=function(f,g,h,d,e){function c(k,l){var i,j;switch(k.length){case 0:i="end of input";break;case 1:i=k[0];break;default:i=k.slice(0,k.length-1).join(", ")+" or "+k[k.length-1]}j=l?b(l):"end of input";return"Expected "+i+" but "+j+" found."}this.name="SyntaxError";this.expected=f;this.found=g;this.message=c(f,g);this.offset=h;this.line=d;this.column=e};a.SyntaxError.prototype=Error.prototype;return a})();