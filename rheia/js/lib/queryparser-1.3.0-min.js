/*
 * http://pegjs.majda.cz/
 *
 * Generated by PEG.js 0.8.0.
 * from followin grammar:
 
Query =
  Expression / ''

Expression =
  left:AndExpr right:(' '+ 'or' ' '+ AndExpr )*
  {
    if(right.length) {
      var result = {or: [left]}
      for( var i=0; i < right.length; i++) {
        result.or.push(right[i][3]);
      }
      return result;
    } else {
      return left;
    }
  }

AndExpr =
  left:Term right:(' '+ 'and' ' '+ Term )*
  {
    if(right.length) {
      var result = {and: [left]}
      for( var i=0; i < right.length; i++) {
        result.and.push(right[i][3]);
      }
      return result;
    } else {
      return left;
    }
  }

Term =
  Token
/
  '(' ' '* expr:Expression ' '* ')' 
  {return expr;}

Token =
  id:Identifier ' '* op:Operator ' '* val:Value 
  {
    var obj = {};
    if (op === ':') {
      val = new RegExp(val, 'im')
    }
    obj[id] = val;
    return obj;
  }

Identifier = 
  first:[a-zA-Z_] next:[a-zA-Z0-9_.]* 
  {return first+next.join('');}

Operator = 
  ':' / '='

Value =
  True / False / String / Float / Integer / '!'

True = 
  'true'
  {return true;}

False= 
  'false'
  {return false;}

Integer =
  sign:'-'? digit:[0-9]+ 
  {return parseInt(sign||''+digit.join(''));}

Float =
  digit:Integer '.' decimal:[0-9]+ 
  {return parseFloat(digit+'.'+decimal.join(''));}

String = 
  '"' content:('\\"' / [^"])* '"' 
  {return content.join('');} 
/
  "'" content:("\\'" / [^'])* "'" 
  {return content.join('');}

 */
QueryParser=(function(){function c(f,d){function e(){this.constructor=f}e.prototype=d.prototype;f.prototype=new e()}function a(g,f,h,i,d,e){this.message=g;this.expected=f;this.found=h;this.offset=i;this.line=d;this.column=e;this.name="SyntaxError"}c(a,Error);function b(aL){var L=arguments.length>1?arguments[1]:{},aD={},k={Query:u},aq=u,al="",aj=aD,ag=[],ae=" ",ac={type:"literal",value:" ",description:'" "'},Z="or",W={type:"literal",value:"or",description:'"or"'},U=function(aU,aT){if(aT.length){var aR={or:[aU]};for(var aS=0;aS<aT.length;aS++){aR.or.push(aT[aS][3])}return aR}else{return aU}},S="and",Q={type:"literal",value:"and",description:'"and"'},d=function(aU,aT){if(aT.length){var aR={and:[aU]};for(var aS=0;aS<aT.length;aS++){aR.and.push(aT[aS][3])}return aR}else{return aU}},aQ="(",aP={type:"literal",value:"(",description:'"("'},aO=")",aN={type:"literal",value:")",description:'")"'},aM=function(aR){return aR},aJ=function(aU,aT,aS){var aR={};if(aT===":"){aS=new RegExp(aS,"im")}aR[aU]=aS;return aR},aI=/^[a-zA-Z_]/,aH={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},aG=/^[a-zA-Z0-9_.]/,aF={type:"class",value:"[a-zA-Z0-9_.]",description:"[a-zA-Z0-9_.]"},aE=function(aS,aR){return aS+aR.join("")},aC=":",aB={type:"literal",value:":",description:'":"'},aA="=",az={type:"literal",value:"=",description:'"="'},ay="!",aw={type:"literal",value:"!",description:'"!"'},av="true",at={type:"literal",value:"true",description:'"true"'},ak=function(){return true},ah="false",af={type:"literal",value:"false",description:'"false"'},ad=function(){return false},aa=null,X="-",V={type:"literal",value:"-",description:'"-"'},T=/^[0-9]/,R={type:"class",value:"[0-9]",description:"[0-9]"},P=function(aR,aS){return parseInt(aR||""+aS.join(""))},I=".",H={type:"literal",value:".",description:'"."'},G=function(aS,aR){return parseFloat(aS+"."+aR.join(""))},E='"',D={type:"literal",value:'"',description:'"\\""'},A='\\"',z={type:"literal",value:'\\"',description:'"\\\\\\""'},y=/^[^"]/,x={type:"class",value:'[^"]',description:'[^"]'},w=function(aR){return aR.join("")},s="'",r={type:"literal",value:"'",description:'"\'"'},q="\\'",p={type:"literal",value:"\\'",description:'"\\\\\'"'},n=/^[^']/,m={type:"class",value:"[^']",description:"[^']"},N=0,B=0,ax=0,f={line:1,column:1,seenCR:false},F=0,aK=[],K=0,l;if("startRule" in L){if(!(L.startRule in k)){throw new Error("Can't start parsing from rule \""+L.startRule+'".')}aq=k[L.startRule]}function ar(){return aL.substring(B,N)}function j(){return B}function i(){return ao(B).line}function t(){return ao(B).column}function h(aR){throw ap(null,[{type:"other",description:aR}],B)}function an(aR){throw ap(aR,null,B)}function ao(aS){function aR(aV,aU,aT){var aX,aW;for(aX=aU;aX<aT;aX++){aW=aL.charAt(aX);if(aW==="\n"){if(!aV.seenCR){aV.line++}aV.column=1;aV.seenCR=false}else{if(aW==="\r"||aW==="\u2028"||aW==="\u2029"){aV.line++;aV.column=1;aV.seenCR=true}else{aV.column++;aV.seenCR=false}}}}if(ax!==aS){if(ax>aS){ax=0;f={line:1,column:1,seenCR:false}}aR(f,ax,aS);ax=aS}return f}function C(aR){if(N<F){return}if(N>F){F=N;aK=[]}aK.push(aR)}function ap(aT,aS,aX){function aW(aZ){var aY=1;aZ.sort(function(a1,a0){if(a1.description<a0.description){return -1}else{if(a1.description>a0.description){return 1}else{return 0}}});while(aY<aZ.length){if(aZ[aY-1]===aZ[aY]){aZ.splice(aY,1)}else{aY++}}}function aR(a2,a3){function aY(a5){function a6(a7){return a7.charCodeAt(0).toString(16).toUpperCase()}return a5.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a7){return"\\x0"+a6(a7)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a7){return"\\x"+a6(a7)}).replace(/[\u0180-\u0FFF]/g,function(a7){return"\\u0"+a6(a7)}).replace(/[\u1080-\uFFFF]/g,function(a7){return"\\u"+a6(a7)})}var aZ=new Array(a2.length),a4,a0,a1;for(a1=0;a1<a2.length;a1++){aZ[a1]=a2[a1].description}a4=a2.length>1?aZ.slice(0,-1).join(", ")+" or "+aZ[a2.length-1]:aZ[0];a0=a3?'"'+aY(a3)+'"':"end of input";return"Expected "+a4+" but "+a0+" found."}var aV=ao(aX),aU=aX<aL.length?aL.charAt(aX):null;if(aS!==null){aW(aS)}return new a(aT!==null?aT:aR(aS,aU),aS,aU,aX,aV.line,aV.column)}function u(){var aR;aR=au();if(aR===aD){aR=al}return aR}function au(){var aW,aV,aU,aT,aS,aR,aY,aX;aW=N;aV=e();if(aV!==aD){aU=[];aT=N;aS=[];if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}if(aR!==aD){while(aR!==aD){aS.push(aR);if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}}}else{aS=aj}if(aS!==aD){if(aL.substr(N,2)===Z){aR=Z;N+=2}else{aR=aD;if(K===0){C(W)}}if(aR!==aD){aY=[];if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}if(aX!==aD){while(aX!==aD){aY.push(aX);if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}}}else{aY=aj}if(aY!==aD){aX=e();if(aX!==aD){aS=[aS,aR,aY,aX];aT=aS}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}while(aT!==aD){aU.push(aT);aT=N;aS=[];if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}if(aR!==aD){while(aR!==aD){aS.push(aR);if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}}}else{aS=aj}if(aS!==aD){if(aL.substr(N,2)===Z){aR=Z;N+=2}else{aR=aD;if(K===0){C(W)}}if(aR!==aD){aY=[];if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}if(aX!==aD){while(aX!==aD){aY.push(aX);if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}}}else{aY=aj}if(aY!==aD){aX=e();if(aX!==aD){aS=[aS,aR,aY,aX];aT=aS}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}}if(aU!==aD){B=aW;aV=U(aV,aU);aW=aV}else{N=aW;aW=aj}}else{N=aW;aW=aj}return aW}function e(){var aW,aV,aU,aT,aS,aR,aY,aX;aW=N;aV=v();if(aV!==aD){aU=[];aT=N;aS=[];if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}if(aR!==aD){while(aR!==aD){aS.push(aR);if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}}}else{aS=aj}if(aS!==aD){if(aL.substr(N,3)===S){aR=S;N+=3}else{aR=aD;if(K===0){C(Q)}}if(aR!==aD){aY=[];if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}if(aX!==aD){while(aX!==aD){aY.push(aX);if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}}}else{aY=aj}if(aY!==aD){aX=v();if(aX!==aD){aS=[aS,aR,aY,aX];aT=aS}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}while(aT!==aD){aU.push(aT);aT=N;aS=[];if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}if(aR!==aD){while(aR!==aD){aS.push(aR);if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}}}else{aS=aj}if(aS!==aD){if(aL.substr(N,3)===S){aR=S;N+=3}else{aR=aD;if(K===0){C(Q)}}if(aR!==aD){aY=[];if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}if(aX!==aD){while(aX!==aD){aY.push(aX);if(aL.charCodeAt(N)===32){aX=ae;N++}else{aX=aD;if(K===0){C(ac)}}}}else{aY=aj}if(aY!==aD){aX=v();if(aX!==aD){aS=[aS,aR,aY,aX];aT=aS}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}}else{N=aT;aT=aj}}if(aU!==aD){B=aW;aV=d(aV,aU);aW=aV}else{N=aW;aW=aj}}else{N=aW;aW=aj}return aW}function v(){var aW,aV,aU,aT,aS,aR;aW=ab();if(aW===aD){aW=N;if(aL.charCodeAt(N)===40){aV=aQ;N++}else{aV=aD;if(K===0){C(aP)}}if(aV!==aD){aU=[];if(aL.charCodeAt(N)===32){aT=ae;N++}else{aT=aD;if(K===0){C(ac)}}while(aT!==aD){aU.push(aT);if(aL.charCodeAt(N)===32){aT=ae;N++}else{aT=aD;if(K===0){C(ac)}}}if(aU!==aD){aT=au();if(aT!==aD){aS=[];if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}while(aR!==aD){aS.push(aR);if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}}if(aS!==aD){if(aL.charCodeAt(N)===41){aR=aO;N++}else{aR=aD;if(K===0){C(aN)}}if(aR!==aD){B=aW;aV=aM(aT);aW=aV}else{N=aW;aW=aj}}else{N=aW;aW=aj}}else{N=aW;aW=aj}}else{N=aW;aW=aj}}else{N=aW;aW=aj}}return aW}function ab(){var aW,aV,aU,aT,aS,aR;aW=N;aV=O();if(aV!==aD){aU=[];if(aL.charCodeAt(N)===32){aT=ae;N++}else{aT=aD;if(K===0){C(ac)}}while(aT!==aD){aU.push(aT);if(aL.charCodeAt(N)===32){aT=ae;N++}else{aT=aD;if(K===0){C(ac)}}}if(aU!==aD){aT=g();if(aT!==aD){aS=[];if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}while(aR!==aD){aS.push(aR);if(aL.charCodeAt(N)===32){aR=ae;N++}else{aR=aD;if(K===0){C(ac)}}}if(aS!==aD){aR=o();if(aR!==aD){B=aW;aV=aJ(aV,aT,aR);aW=aV}else{N=aW;aW=aj}}else{N=aW;aW=aj}}else{N=aW;aW=aj}}else{N=aW;aW=aj}}else{N=aW;aW=aj}return aW}function O(){var aU,aT,aS,aR;aU=N;if(aI.test(aL.charAt(N))){aT=aL.charAt(N);N++}else{aT=aD;if(K===0){C(aH)}}if(aT!==aD){aS=[];if(aG.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(aF)}}while(aR!==aD){aS.push(aR);if(aG.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(aF)}}}if(aS!==aD){B=aU;aT=aE(aT,aS);aU=aT}else{N=aU;aU=aj}}else{N=aU;aU=aj}return aU}function g(){var aR;if(aL.charCodeAt(N)===58){aR=aC;N++}else{aR=aD;if(K===0){C(aB)}}if(aR===aD){if(aL.charCodeAt(N)===61){aR=aA;N++}else{aR=aD;if(K===0){C(az)}}}return aR}function o(){var aR;aR=M();if(aR===aD){aR=ai();if(aR===aD){aR=J();if(aR===aD){aR=am();if(aR===aD){aR=Y();if(aR===aD){if(aL.charCodeAt(N)===33){aR=ay;N++}else{aR=aD;if(K===0){C(aw)}}}}}}}return aR}function M(){var aS,aR;aS=N;if(aL.substr(N,4)===av){aR=av;N+=4}else{aR=aD;if(K===0){C(at)}}if(aR!==aD){B=aS;aR=ak()}aS=aR;return aS}function ai(){var aS,aR;aS=N;if(aL.substr(N,5)===ah){aR=ah;N+=5}else{aR=aD;if(K===0){C(af)}}if(aR!==aD){B=aS;aR=ad()}aS=aR;return aS}function Y(){var aU,aT,aS,aR;aU=N;if(aL.charCodeAt(N)===45){aT=X;N++}else{aT=aD;if(K===0){C(V)}}if(aT===aD){aT=aa}if(aT!==aD){aS=[];if(T.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(R)}}if(aR!==aD){while(aR!==aD){aS.push(aR);if(T.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(R)}}}}else{aS=aj}if(aS!==aD){B=aU;aT=P(aT,aS);aU=aT}else{N=aU;aU=aj}}else{N=aU;aU=aj}return aU}function am(){var aV,aU,aT,aS,aR;aV=N;aU=Y();if(aU!==aD){if(aL.charCodeAt(N)===46){aT=I;N++}else{aT=aD;if(K===0){C(H)}}if(aT!==aD){aS=[];if(T.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(R)}}if(aR!==aD){while(aR!==aD){aS.push(aR);if(T.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(R)}}}}else{aS=aj}if(aS!==aD){B=aV;aU=G(aU,aS);aV=aU}else{N=aV;aV=aj}}else{N=aV;aV=aj}}else{N=aV;aV=aj}return aV}function J(){var aU,aT,aS,aR;aU=N;if(aL.charCodeAt(N)===34){aT=E;N++}else{aT=aD;if(K===0){C(D)}}if(aT!==aD){aS=[];if(aL.substr(N,2)===A){aR=A;N+=2}else{aR=aD;if(K===0){C(z)}}if(aR===aD){if(y.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(x)}}}while(aR!==aD){aS.push(aR);if(aL.substr(N,2)===A){aR=A;N+=2}else{aR=aD;if(K===0){C(z)}}if(aR===aD){if(y.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(x)}}}}if(aS!==aD){if(aL.charCodeAt(N)===34){aR=E;N++}else{aR=aD;if(K===0){C(D)}}if(aR!==aD){B=aU;aT=w(aS);aU=aT}else{N=aU;aU=aj}}else{N=aU;aU=aj}}else{N=aU;aU=aj}if(aU===aD){aU=N;if(aL.charCodeAt(N)===39){aT=s;N++}else{aT=aD;if(K===0){C(r)}}if(aT!==aD){aS=[];if(aL.substr(N,2)===q){aR=q;N+=2}else{aR=aD;if(K===0){C(p)}}if(aR===aD){if(n.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(m)}}}while(aR!==aD){aS.push(aR);if(aL.substr(N,2)===q){aR=q;N+=2}else{aR=aD;if(K===0){C(p)}}if(aR===aD){if(n.test(aL.charAt(N))){aR=aL.charAt(N);N++}else{aR=aD;if(K===0){C(m)}}}}if(aS!==aD){if(aL.charCodeAt(N)===39){aR=s;N++}else{aR=aD;if(K===0){C(r)}}if(aR!==aD){B=aU;aT=w(aS);aU=aT}else{N=aU;aU=aj}}else{N=aU;aU=aj}}else{N=aU;aU=aj}}return aU}l=aq();if(l!==aD&&N===aL.length){return l}else{if(l!==aD&&N<aL.length){C({type:"end",description:"end of input"})}throw ap(null,aK,F)}}return{SyntaxError:a,parse:b}})();