/*
* jQuery UI Numeric Up/Down v1.2
*
* Copyright 2011, Tony Kramer
* Dual licensed under the MIT or GPL Version 2 licenses.
* https://github.com/flamewave/jquery-ui-numeric/raw/master/GPL-LICENSE.txt
* https://github.com/flamewave/jquery-ui-numeric/raw/master/MIT-LICENSE.txt
*
* https://github.com/flamewave/jquery-ui-numeric
*
* Dependencies:
* - jQuery (1.4.2)
* - jQuery-ui (1.8.6 - core, widget, button)
*/
(function($){$.widget('ui.numeric',{version:'1.2',options:{disabled:false,keyboard:true,showCurrency:false,currencySymbol:'$',title:'Type a new value or use the buttons or keyboard arrow keys to change the value. Hold Ctrl or Shift for a smaller or larger increment, respectively.',buttons:true,upButtonIcon:'ui-icon-triangle-1-n',upButtonTitle:'Increment the value. Hold Ctrl or Shift for a smaller or larger increment, respectively.',downButtonIcon:'ui-icon-triangle-1-s',downButtonTitle:'Decrement the value. Hold Ctrl or Shift for a smaller or larger increment, respectively.',emptyValue:0,minValue:false,maxValue:false,smallIncrement:1,increment:5,largeIncrement:10,calc:null,format:{format:'0',decimalChar:'.',thousandsChar:','}},_adjustmentFlag:false,_keyDownFlag:false,_timer:null,_name:'numeric',_value:0,_create:function(){var t=this,o=t.options,w=t.widget(),type=w.attr('type').toLowerCase();if(type!=='text'&&type!=='number')throw'numeric widget can only be applied to text and number inputs.';t._checkFormat();t._name=w.attr('id')||w.attr('name');t._value=t._getInputValue(w.attr('value'),true);if(o.minValue!==false&&t._value<o.minValue)t._value=o.minValue;if(o.maxValue!==false&&t._value>o.maxValue)t._value=o.maxValue;t._setInputValue(t._value);w.attr('title',o.title).wrap($('<div class="ui-widget ui-widget-content ui-corner-all ui-numeric" />'));if(o.showCurrency)t._createCurrency();if(o.buttons)t._createButtons();w.bind({keydown:function(event){return t._onKeyDown(event)},keyup:function(event){return t._onKeyUp(event)},change:function(event){return t._onChange(event)}});if(o.disabled||w.attr('disabled'))t._setOption('disabled',true);$(window).bind('unload',function(){t.destroy()})},destroy:function(){var t=this,w=t.widget();w.unbind({keydown:function(event){return t._onKeyDown(event)},keyup:function(event){return t._onKeyUp(event)},change:function(event){return t._onChange(event)}});if(t.options.showCurrency)$('#'+t._name+'_currency').remove();if(t.options.buttons)$('#'+t._name+'_buttons').remove();w.unwrap();$.Widget.prototype.destroy.apply(t);$(window).unbind('unload',function(){t.destroy()})},_createCurrency:function(){this.widget().before($('<div/>').attr('id',this._name+'_currency').addClass('ui-numeric-currency').html(this.options.currencySymbol))},_createButtons:function(){var t=this;var btnUp=$('<button type="button"></button>').attr('title',t.options.upButtonTitle).bind({keydown:function(event){keydown(event,false)},keyup:function(){up()},mousedown:function(event){down(event,false)},mouseup:function(){up()}}).button({text:false,label:'U',icons:{primary:t.options.upButtonIcon}});var btnDown=$('<button type="button"></button>').attr('title',t.options.downButtonTitle).bind({keydown:function(event){keydown(event,true)},keyup:function(){up()},mousedown:function(event){down(event,true)},mouseup:function(){up()}}).button({text:false,label:'D',icons:{primary:t.options.downButtonIcon}});t._addButtons(btnUp,btnDown);function keydown(event,neg){if(event.which==32||event.which==13){down(event,neg);event.target.focus()}}function down(event,neg){(neg?btnUp:btnDown).blur();var inc=t._getIncrement(event.ctrlKey,event.shiftKey);t._adjustValueRecursive(neg?-inc.value:inc.value,inc.type)}function up(){clearTimeout(t._timer)}},_addButtons:function(btnUp,btnDown){this.widget().after($('<div/>').attr('id',this._name+'_buttons').addClass('ui-numeric-buttons').append(btnUp).append(btnDown))},_setOption:function(key,value){var t=this,o=t.options;switch(key){case'disabled':var w=t.widget();w.parent()[value?'addClass':'removeClass']('ui-numeric-disabled ui-state-disabled').attr('aria-disabled',value);t._adjustmentFlag=true;if(value)w.attr({disabled:'disabled',value:''});else w.removeAttr('disabled').attr('value',t._format(t._value));t._adjustmentFlag=false;if(o.buttons)$('#'+t._name+'_buttons button').button(value?'disable':'enable');break;case'emptyValue':o.emptyValue=value;t._setValue(t._value);break;case'minValue':o.minValue=value===false?false:_numVal(value);if(o.minValue!==false&&t._value<o.minValue)t._setValue(o.minValue);break;case'maxValue':o.maxValue=value===false?false:_numVal(value);if(o.maxValue!==false&&t._value>o.maxValue)t._setValue(o.maxValue);break;case'format':o.format=value;t._checkFormat();t._setValue(t._value);break;case'title':o.title=value;t.widget().attr('title',value);break;case'showCurrency':if(value&&!o.showCurrency)t._createCurrency();else if(!value&&o.showCurrency)$('#'+t._name+'_currency').remove();o.showCurrency=value;break;case'currencySymbol':o.currencySymbol=value;if(o.showCurrency)$('#'+t._name+'_currency').html(value);break;case'buttons':if(value&&!o.buttons)t._createButtons();else if(!value&&o.buttons)$('#'+t._name+'_buttons').remove();o.buttons=value;break;case'upButtonIcon':o.upButtonIcon=value;if(o.buttons)$('#'+t._name+'_buttons').find('button:eq(0)').button('option','icons',{primary:value});break;case'upButtonTitle':o.upButtonTitle=value;if(o.buttons)$('#'+t._name+'_buttons').find('button:eq(0)').attr('title',value);break;case'downButtonIcon':o.downButtonIcon=value;if(o.buttons)$('#'+t._name+'_buttons').find('button:eq(1)').button('option','icons',{primary:value});break;case'downButtonTitle':o.downButtonTitle=value;if(o.buttons)$('#'+t._name+'_buttons').find('button:eq(1)').attr('title',value);break;default:$.Widget.prototype._setOption.apply(t,key,value);break}return t},_checkFormat:function(){var o=this.options;if(typeof o.format==='string')o.format={format:o.format,decimalChar:'.',thousandsChar:','};else o.format=$.extend({format:'0',decimalChar:'.',thousandsChar:','},o.format)},_getInputValue:function(val,parse){val=val.replace(new RegExp(regExEscape(this.options.format.thousandsChar),'g'),'');if(this.options.format.decimalChar!=='.')val=val.replace(new RegExp(regExEscape(this.options.format.decimalChar),'g'),'.');return parse?_numVal(val):val},_setInputValue:function(val){this._adjustmentFlag=true;this.widget().attr('value',this._format(val)).change();this._adjustmentFlag=false},_setValue:function(val){var t=this;val=_numVal(val);if(t.options.minValue!==false&&val<t.options.minValue)val=t.options.minValue;if(t.options.maxValue!==false&&val>t.options.maxValue)val=t.options.maxValue;t._value=val;if(!t.options.disabled)t._setInputValue(val)},_format:function(val){var o=this.options;return isNaN(val)||(o.emptyValue!==false&&val===o.emptyValue)?'':$.formatNumber(val,o.format)},_getIncrement:function(ctrl,shift){if(ctrl)return{value:this.options.smallIncrement,type:2};else if(shift)return{value:this.options.largeIncrement,type:3};return{value:this.options.increment,type:1}},_adjustValue:function(amount,type){var t=this;if(t.options.disabled)return;t._setValue($.isFunction(t.options.calc)?t.options.calc(t._value,type,amount<0?2:1):t._value+amount);t.select()},_adjustValueRecursive:function(amount,type){$.ui.numeric._current=this;$.ui.numeric._timerCallback(amount,type,true)},_onKeyDown:function(event){var t=this,o=t.options;if(o.disabled)return;switch(event.which){case 109:case 110:case 190:t._keyDownFlag=true;return;case 38:case 40:if(o.keyboard){var inc=t._getIncrement(event.ctrlKey,event.shiftKey);t._adjustValue(event.which==40?-inc.value:inc.value,inc.type)}return;case 33:if(o.keyboard)t._adjustValue(o.largeIncrement,3);return;case 34:if(o.keyboard)t._adjustValue(-o.largeIncrement,3);return;case 65:case 67:case 86:case 88:case 89:case 90:if(event.ctrlKey)return;break}if(isControlKey(event.which))return;if(!isNumericKey(event.which)){event.preventDefault();event.stopPropagation();return}},_onKeyUp:function(){var t=this,v=parseFloat(t._getInputValue(t.widget().attr('value'),false));if(!isNaN(v))t._value=v;t._keyDownFlag=false},_onChange:function(event){if(!this._adjustmentFlag&&!this._keyDownFlag)this._setValue(this._getInputValue(event.target.value),true)},value:function(val){if(val===undefined)return this._value;this._setValue(val);return this},select:function(){if(!this.options.disabled)this.widget().select();return this}});$.ui=$.ui||{};$.ui.numeric._current=null;$.ui.numeric._timerCallback=function(amount,type,first){clearTimeout($.ui.numeric._current._timer);$.ui.numeric._current._adjustValue(amount,type);$.ui.numeric._current._timer=setTimeout('jQuery.ui.numeric._timerCallback('+amount+','+type+',false)',first?1000:50)};function isControlKey(keyCode){return(keyCode<=47&&keyCode!=32)||(keyCode>=91&&keyCode<=95)||(keyCode>=112&&[188,190,191,192,219,220,221,222].indexOf(keyCode)==-1)}function isNumericKey(keyCode){return(keyCode>=48&&keyCode<=57)||(keyCode>=96&&keyCode<=105)}function _numVal(val){if(typeof val!=='number')val=Number(val);if(isNaN(val))return 0;return val}function replicate(str,count){var v_retval='';for(var i=0;i<count;i++)v_retval+=str;return v_retval}var REGEX_ESCAPE=new RegExp('(\\'+['/','.','*','+','?','|','(',')','[',']','{','}','\\'].join('|\\')+')','g');function regExEscape(val){return val.replace(REGEX_ESCAPE,'\\$1')}$.formatNumber=function(num,options){num=_numVal(num);if(typeof options==='string')options={format:options};options=$.extend({format:null,decimalChar:'.',thousandsChar:','},options);if(typeof options.format!=='string'||options.format.length<=0)return num.toString();options.decimalChar=typeof options.decimalChar!=='string'||options.decimalChar.length<=0?'.':options.decimalChar;options.thousandsChar=typeof options.thousandsChar!=='string'?',':options.thousandsChar;if(options.decimalChar.length>1)throw'NumberFormatException: Can not have multiple characters as the decimal character.';if(options.thousandsChar.length>1)throw'NumberFormatException: Can not have multiple characters as the thousands separator.';var v_dec_index=options.format.indexOf(options.decimalChar);if(v_dec_index>=0&&options.format.indexOf(options.decimalChar,v_dec_index+1)>=0)throw'NumberFormatException: Format string has multiple decimal characters.';var v_num_as_string=num.toString().replace(/-/g,''),v_clean_format=options.format.replace(new RegExp('[^0#'+regExEscape(options.decimalChar)+']','g'),''),v_num_parts=v_num_as_string.indexOf(options.decimalChar)<0?[v_num_as_string,'']:v_num_as_string.split(options.decimalChar),v_format_parts=v_dec_index<0?[v_clean_format,'']:v_clean_format.split(options.decimalChar);if(parseInt(num)===0)v_num_parts[0]=v_format_parts[0].indexOf('0')>=0?'0':'';if(options.format.indexOf(options.thousandsChar)>=0&&v_num_parts[0].length>3){var v_int_thousands_array=[],j=v_num_parts[0].length,m=Math.floor(j/3),n=v_num_parts[0].length%3||3;for(var i=0;i<j;i+=n){if(i!=0)n=3;v_int_thousands_array[v_int_thousands_array.length]=v_num_parts[0].substr(i,n);m-=1}v_num_parts[0]=v_int_thousands_array.join(options.thousandsChar)}if(v_format_parts[1].length>0){if(v_num_parts[1].length>0){var v_format_array=v_format_parts[1].split(''),v_dec_part_array=v_num_parts[1].split('');for(var i=0;i<v_dec_part_array.length;i++){if(i>=v_format_array.length)break;v_format_array[i]=v_dec_part_array[i]}v_num_parts[1]=v_format_array.join('').replace(/#/g,'')}else{var v_index=0;v_num_parts[1]='';while(v_format_parts[1].charAt(v_index)==='0'){v_num_parts[1]+='0';v_index++}}}else v_num_parts[1]='';var v_retval=(v_num_parts[1].length<=0)?v_num_parts[0]:v_num_parts[0]+options.decimalChar+v_num_parts[1];if(num<0)v_retval='-'+v_retval;return options.format.replace(new RegExp('[0|#|'+regExEscape(options.thousandsChar)+'|'+regExEscape(options.decimalChar)+']+'),v_retval)};Number.prototype.roundRight=function(numberOfDecimals){numberOfDecimals=_numVal(numberOfDecimals);var v_pow=Math.pow(10,numberOfDecimals);return Math.round(this*v_pow)/v_pow};Number.prototype.pad=function(numberOfDigits){numberOfDigits=_numVal(numberOfDigits);var v_string=String(this.valueOf()),v_s_len=v_string.length;if(v_s_len<numberOfDigits){for(var i=v_s_len;i<numberOfDigits;i++)v_string='0'+v_string}return v_string};Number.prototype.padRight=function(numberOfDigits){numberOfDigits=_numVal(numberOfDigits);var v_string=String(this.valueOf()),v_s_len=v_string.length-(this%1>0?1:0);if(v_s_len<numberOfDigits){for(var i=v_s_len;i<numberOfDigits;i++)v_string=v_string+'0'}return v_string};Number.prototype.padDecimals=function(numberOfDecimals){numberOfDecimals=_numVal(numberOfDecimals);var v_parts=String(this.valueOf()).split('.');if(v_parts.length<=0)return numberOfDecimals>0?'0.'+replicate('0',numberOfDecimals):'0';if(v_parts.length==1)return v_parts[0]+(numberOfDecimals>0?'.'+replicate('0',numberOfDecimals):'');return v_parts[0]+(numberOfDecimals>0?'.'+parseInt(v_parts[1]).padRight(numberOfDecimals):'')};Number.prototype.getOrdinal=function(){if(this>100)return(this%100).getOrdinal();if(this>=11&&this<=19)return'th';switch(this%10){case 1:return'st';case 2:return'nd';case 3:return'rd'}return'th'};Number.prototype.format=function(options){$.formatNumber(this,options)};Number.prototype.formatCurrency=function(options){options=$.extend({symbol:'$',noParens:false,format:'#,##0.00',decimalChar:'.',thousandsChar:','},options);var v_retval=Math.abs(this).format(options);if(this<0)return options.noParens?'-'+options.symbol+v_retval:'('+options.symbol+v_retval+')';return v_retval}})(jQuery);