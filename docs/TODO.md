# TODO

- Hyperion
  - Bugs
    - item in player character is still present after a map deletion
  - heroku: reload game.repo from s3 at dyno startup, save periodically 
  - test images for field types and event types
  - Documentation
  - Rule engine
    - [!!!] Handle 'No matching document found' version errors while executing rule and revert execution
    - provide rule triggering inside rules, with reloading when imported ruless changed (IA ?)
    - secured rules > mock save() and remove() methods from instances, collection and update() from classes
  - Security
    - register users from Facebook

- Rheia
  - Bugs
    - [!!!] in authoring, some modified files have the title asterisk, but no buttons/shortcut enabled
    - [!!] revert file to version is broken, rule/script versionning not implemented
    - use tileDim in hexagon and diamond map renderers
    - when affecting a field on existing field, new field isn't drawn (edition perspective)
    - refresh edition and moderation map content (is there any cache ?) when removing a field type
  - Documentation
  - Authoring perspective
    - [!] multiple file search
  - use non rectangular clipping when removing field in map widgets http://jsfiddle.net/alnitak/6ABp7/

- Atlas
  - package as library for es6, common JS and require
  - Documentation

# Done

- Hyperion
  - Bugs
    - modified linked model (not linked to actor nor target) not detected as modified and not saved by rules
    - model cache retains old object version: clean worker model cache when any thread failed
    - temper executable require during resetAll until all executable compilation
    - avoid message collision between ruleService and ruleExecutor on same executed method
    - avoid sending duplicates to Mongo on saves (fix duplicate key error)
    - fix infinite loop while detecting model changes before save
    - allow dev reconnection on server failure
    - fetch now uses cache, to avoid referencing with two different models the same entity. Unless explicitly specified GameService.getItem(), GameService.getEvent()) for serialization reasons
    - use cache to resolve player characters
    - Enforce type order same as id order in findCached
    - remove item type property does not update existing items
    - bug with map value when retrieving items with search
    - fix from handling at event creation
    - save new item on a new map : mapId stored in DB, but map object not affected to item (modelWatcher does not send the map)
  - ImageService to upload and associate images to types
  - remove all images when removing a type
  - Field type CRUD
  - Map CRUD
  - destroys map items and fields when destroying map
  - Field CRUD
  - Item CRUD for administrators
  - Detect changes on dynamic array linked properties
  - disabled turn-rules/rules
  - do not send linked objects within modelWatcher, just ids
  - turn-rules ordering rank
  - Event type CRUD
  - Event CRUD with link to from, creation and update dates
  - Logger refactoring, override console standard functions and send logs to admin clients
  - Central configuration and i18n utility for clients (types, rules, others...) in YAML, modifiable as string and readable as JSON
  - Model cache evinction on fixed duration and thread crash
  - JSON properties in Item/Event types, and JSON rules parameters
  - Players 
    - CRUD with AdminService
    - password management and protection for manually provided accounts
    - kick player: disconnect socket when disconnecting
    - detect changes on characters
  - Map items and their types
    - CRUD in database (Items, Fields, Maps)
    - Dynamic properties
      - declaration and enforcement 
      - type-checking
      - links resolution at server side
    - Modifications propagation
  - Search service for types
    - (item, event, field, map, rule, turn-rule) search by id (val is string)
    - (item, event, field, map, rule, turn-rule) search 'val' (as string/regex) in name (locale is parametrized)
    - (item, event, field) search 'val' (as string/regex) in name (locale is parametrized)
    - (item, event) search property 'p' existence
    - (item, event) search property 'p' default value 'val' (anything)
    - (item) search quantifiable 'val' (boolean)
    - (rule) search 'val' (as string/regexp) in category
    - (turn-rule) search 'val' (as number) in rank
    - (rule, turn-rule) search 'val' (as string/regexp) in body
  - Search service for instances
    - (item, event, player) search by id (val is string)
    - (item, event) search property 'p' existence
    - (item, event) search property 'p' containing value 'val' (val is anything)
    - (item, event) search property 'p.sp' where linked object has a property 'sp'
    - (item, event) search property 'p.sp' where linked object contains property 'sp' with value 'val' (val is anything)
    - (item, event) search type by id (val is string)
    - (item, event) search type where property 'p' exists
    - (item, event) search type where property 'p' has value 'val' (val is anything)
    - (item) search map by id (val is string)
    - (item) search map exists
    - (item) search map where property 'p' has value 'val' (val is anything)
    - (item) search by quantity (val is number)
    - (player) search by characters existence
    - (player) search by characters id (val is string)
    - (player) search by characters where property 'p' exists
    - (player) search by characters where property 'p' has value 'val' (val is anything)
    - (player) search by preference content
    - (player) search by email, firstName, lastName
  - Authoring service and FSItem
    - get FSItem
    - save FSItem
    - remove FSItem
    - rename/move FSItem
    - service layer
    - web layer
    - commit FSItem on save
    - get FSItem/Executable history
    - get FSItem/Executable version
    - list deleted FSItem/Executable
  - Authoring Service and game deployment
    - compile stylus, coffee and optimize js and css
    - move to production path and create unic url for resources
    - create git version (files and executables)
    - revert to previous version (files and executables)
    - list existing versions and current
    - allow/block non-administrator login
    - return current version and deployed version
    - restrict game dev to administors
    - serve production version with cache and gzip
  - Security
    - kick users after inactivity
    - register users from Google
    - register users from Twitter
    - register users from Github
    - register user manually
    - enforce user existence and rights at socket.io handshake
    - disable security for tests
    - re-authent user after disconnection
    - manual user logout 
    - session expiration on last connection date, that can be disabled from configuration
    - restrict rheia access to administrators only
    - test password management of manually registered players
    - detect client disconnection and claim for logout after 10 seconds
  - Rule engine 
    - restrict rule resolution to given categories
    - restrict rule resolution to given rule id
    - path to node_modules from rules
    - file system storage and compilation
    - runtime resolution and execution at server side
    - runtime resolution at client side
    - items creation and removal
    - items updates
    - turn rules
    - turns notifications on success and error cases
    - handle require error cases on executables
    - rule may require parameters
    - rule resolution and execution on players, fields, items and events
    - when resolving with coordinates, resolves only on actor's map 
    - check execute() parameters validity (missing, value's type, string/object within, min-max, number of occurences)
    - asynchronous error handling
    - separated thread for turn rules and execution rules
    - update thread model caches on other thread updates
    - modifiable, pausable and unic date system for rules
    - reference dependencies to hyperions modules as 'hyperion' instead of '../'
    - do not exports inactive or turn rules to client
    - remove models by id in rule's removed array
    - allow rule, turn rule and script to be written in plain javascript
    - inject current player inside resolve's and execute's context
  - Web layer
    - retrieve item, event and field types 
    - map items CRUD invokation
    - rule engine invokation
    - rules retrieval
    - map items modification propagation
    - secured websocket
    - use socket.io 1.0.0-pre

- Rheia
  - Bugs
    - image carousel in field type not properly working with exotic image sizes
    - double numeric contols in newest firfox for number properties
    - player token invalidated after player edition
    - when update received on an item moderation view, displayed image is wrong
    - moderation map does not shows item movement when specified transition isn't found
    - remove linked in moderation view does not really remove link in db
    - multiple item menu is above item rendering in moderation map
    - item misplaced after drag'n drop of moderation map
    - no rule category displayed in rule tree
    - spaces inside tab names 
    - rule with category appears in turnRules in search results
    - browser do not retain passwords
    - model destruction, and remaining destroyed items on map
    - manage type retrival
    - fix dynamic properties handling at event/item creation
    - fix contextual menu and tooltip overlap in search results, and instance image updates
    - no map update when adding new content
    - fix shortcut handling when mulitple perspecitve are loaded
    - fix multiple events received after reloading
    - configuration merge not displayed
    - an actor rule can be created with a turn rule/script name and erase it 
    - FSItem move popup does not close on ok
    - item's map changes not displayed in moderation (when map was previously not existing)
    - fix rule/turn rule active/category/rank changes
  - provide english default labels, and french translation
  - handle rule requires
  - perspective loader
  - login page
  - logout button
  - error reporting on network failure, kick and deployement in progress cases
  - reconnection management, page reloading management
  - display connected count in top bar
  - authoring perspective
    - reload when changing game client version
    - error handling while saving/moving/removing files (during deployement)
    - Perspective
      - file tab widget
      - create new file/folder
      - upload in selected
      - rename selected
      - delete selected
    - File Explorer
      - items loading
      - items navigation and selection
      - update when item added or removed
      - contextual menu
    - File View
      - action bar (save, delete)
      - editor widget
      - loading/save content
      - external modification/removal notification
      - displays images
      - dot not save when restoring previous version
    - History
      - display file's history
      - revert to file version
  - edition perspective
    - check that search is reloaded only on types changed
    - contextual menus in search and explorer
    - Maps
      - map name and validation
      - map kind (square, diamond, hexa)
      - hexagonal map widget
      - drag'n drop from explorer
      - remove selection
      - display/hide grid
      - zoom in, zoom out
      - selection with Ctrl
      - selection with Shift
      - multiple affectation
      - zoom, toggle markers and toggle grid commands
      - choose tile size and use it in display
      - display hovered field position, type and image num
    - Search
      - input query with help and validation
      - display result and navigates
    - auto-adjust panel top when tabs are added/removed and when window is resized
    - ItemType
      - static fields and description image
      - properties
      - instance images
      - sprites, with percent size of map tile size
      - validation
      - quantity management
      - JSON properties
    - EventType
    - FieldType
      - static fields and description image
      - instance images
      - image carousel in explorer
    - Rule/TurnRule/Scripts
      - categories in explorer
      - static fields (name, category) with validation
      - rule body
      - rule CRUD
      - rule special behaviour when renaming
      - try to reload executable when initializing executables on requirejs errors
      - written in JavaScript or CoffeeScript
    - Client configuration
      - written in YAML
  - administration perspective
    - create and restore game client versions
    - display externally triggered deployements
    - game client version list 
    - deploy, commit and rollback
    - error handling on AdminService
    - report last executed turn
    - trigger turn execution
  - moderation perspective
    - apply rules on item/events/players, with current embodiment
    - Maps
      - maps list, switch current map
      - displayal with fields and items
      - map controls
      - map moves by drag' drop
      - items rendering update
      - item click
      - item affectation and moves by drag'n drop
      - multiple item menu
      - items animations (with z-ordering)
      - use map tile size
    - Items
      - CRUD
      - external updates and removal
      - quantity management
      - display and edit dynamic properties, and update rendering when changes detected
      - displays, edits and navigates to linked
      - restrict drop operations on object/array properties
      - display tooltip on object/array properties
      - update 'array'/'object' properties when removing an item/event
      - ability to embody an item
      - check JSON propeties validity
    - Events 
      - CRUD
      - sort event by update date in properties
      - display tooltip on object/array properties
    - Players 
      - CRUD (email, firstName, lastName, prefs, characters, isAdmin, lastConnection)
      - providers and password management
      - kick
    - Search
      - input query with help and validation (use : for regexp and = for string)
      - display result and navigates
      - display tooltip and affect by drag'n drop
      - do not reload search results when instance changed
      - contextual menu in search results

- Atlas
  - Provide connection facilities
  - Provide bindings for all models and their types
  - Implement rule services
  - create and automate tests

# Consequent changes
  - mongoDB instead MySQL, NodeJS instead Java
  - no more distinction between Items and Actors
  - no more event on actors
  - no more link between rules and actors
  - hexagonal and 3D iso maps
  - event-kind properties
  - date-kind properties
  - connect with Google, Twitter
  - drop from Item/Event/Player tabs
  - sprite management for animations and transition
  - rules in CoffeeScript and Javascript
  - isomorphic rules: can partially be executed on client to increase reactivity
  - WebSocket everywhere: increase speed
  - rendering template for events
  - live log displayal on Rheia
  - faster game client optimization process, automatic versionning
  - game client files and rules history, with possible rollback (even for removed/renamed files)
  - a central configuration and i18n file for clients to store types names, rules results, and any labels
  - much more fast and reliable